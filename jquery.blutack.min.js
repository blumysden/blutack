(function(){"use strict";function t(t){return t.data("tackProps")}function i(t,i){t.data("tackProps",i)}function e(e){if(!t(g(this))){var o=g(this),n=e.offsetTop,s=o.offset(),a=s.top-n,f=o.css("position")||"static",r={offsetTop:parseInt(n,10),offsetLeft:"static"!=f?s.left:"auto",tackAt:a,proxyId:y+w,keepWithin:e.keepWithin?g(e.keepWithin):null,height:o.outerHeight(),initial:{position:f,width:e.freezeWidth?o.css("width"):"auto",top:o.css("top")||"auto",right:o.css("right"),left:o.css("left"),"float":o.css("float")},options:e};i(o,r),k[a]?k[a].free.push(o):k[a]={free:[o],tacked:[]},w+=1,m+=1,v.push(this),1!=m||b||(b=!0,p()),h()}}function o(){var e,o=g(this),n=t(o)||{},s=o.hasClass(x)?"tacked":"free",f=k[n.tackAt];if(f)for(e=f[s].length-1;e>=0;e--)if(f[s][e].get(0)==this){f[s].splice(e,1),a(o),i(o,null),m-=1,g("#"+n.proxyId).remove();break}for(var e=v.length-1;e>=0;e--)if(v[e]==this){v.splice(e,1);break}}function n(i){var e=t(i),o=g("#"+e.proxyId),n=!o.length;n&&(o=g('<div id="'+e.proxyId+'"></div>'),o.insertBefore(i)),c(i),i.css({position:"fixed",top:e.offsetTop,left:e.offsetLeft,right:"auto"}).addClass(x).data("isPinched",!1),n&&o.height(e.height).css(e.initial),o.show()}function s(i,e){var o=t(i);i.css({top:o.offsetTop+e}).data("isPinched",!0)}function a(i){var e=t(i);g("#"+e.proxyId).hide(),i.css(e.initial).removeClass(x)}function f(){var i=t(g(this)),n=i?i.options:null;return i?(o.apply(this),e.apply(this,[n]),void 0):!1}function r(i,e){var o,a=t(i),f=a.keepWithin;f&&(o=f.offset().top+f.height()-e-(a.height+a.offsetTop),0>o?s(i,o):i.data("isPinched")&&o>=0&&n(i))}function h(t){var i,e,o,s,f,h,c=g(window).scrollTop(),p=t&&void 0!==u?c>u?"down":"up":null;if(t&&(u=c),!m)return!1;for(f in k)if(k.hasOwnProperty(f)){if(f=Number(f),i=k[f],o=i.tacked,s=i.free,"up"!=p&&c>f&&!i.fixing){for(i.fixing=!0,h=s.length-1;h>=0;h--)e=s.pop(),n(e),o.push(e);i.fixing=!1}else if("down"!=p&&f>=c&&!i.fixing){for(i.fixing=!0,h=o.length-1;h>=0;h--)e=o.pop(),a(e),s.push(e);i.fixing=!1}for(h=o.length-1;h>=0;h--)r(o[h],c)}}function c(i){var e=t(i),o=e.initial.width!="auto"?e.initial.width:i.parent().width()-(i.outerWidth()-i.width());i.width(o)}function p(){m&&(g(window).scroll(h),g(window).on("resize",T),g("body").on("orientationchange",T).on("touchend",h))}function l(t,i){var e,o,n,s,a,f={offsetTop:0,freezeWidth:!1},r=(g(t).data("blutack-options")||"").split(";"),h={};for(a=r.length-1;a>=0;a--)e=r[a].split(":"),e.length==2&&(o=g.trim(e[0]),f[o]!==void 0&&(n=g.trim(e[1]),s=n.match(/d+/),s&&s.length==n.length?n=Number(n):"false"===n?n=!1:"true"===n&&(n=!0),h[o]=n));return g.extend({},f,h,i)}var u,d=this,g=d.jQuery,v=[],k={},w=0,y="blutack-proxy-",x="blutacked",m=0,b=!1;if(g.fn.blutack)return!1;var T=function(){var i;return function(){clearTimeout(i),i=setTimeout(function(){var i,n,s=[];for(n=v.length-1;n>=0;n--)i=v[n],s.push({elem:i,options:t(g(i)).options}),o.apply(i);for(n=s.length-1;n>=0;n--)e.apply(s[n].elem,[s[n].options])},200)}}();g.fn.blutack=function(t){return"remove"==t?this.each(function(){o.apply(this)}):"retack"==t?this.each(function(){f.apply(this)}):"tacked"==t?this.hasClass(x):this.each(function(){e.apply(this,[l(this,t)])})},g(document).ready(function(){g(".blutack").blutack()})}).call(this);