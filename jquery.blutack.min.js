(function(){"use strict";function t(t){return t.data("tackProps")}function i(t,i){t.data("tackProps",i)}function e(e){if(!t(d(this))){var o=d(this),n=e.offsetTop,s=o.offset(),f=s.top-n,r=o.css("position")||"static",h={offsetTop:parseInt(n,10),offsetLeft:"static"!=r?s.left:"auto",tackAt:f,proxyId:w+v,keepWithin:e.keepWithin?d(e.keepWithin):null,height:o.outerHeight(),initial:{position:r,width:e.freezeWidth?o.css("width"):"auto",top:o.css("top")||"auto",right:o.css("right"),left:o.css("left")},options:e};i(o,h),k[f]?k[f].free.push(o):k[f]={free:[o],tacked:[]},v+=1,y+=1,g.push(this),1!=y||m||(m=!0,c()),a()}}function o(){var e,o=d(this),n=t(o)||{},s=o.hasClass(x)?"tacked":"free",r=k[n.tackAt];if(r)for(e=r[s].length-1;e>=0;e--)if(r[s][e].get(0)==this){r[s].splice(e,1),f(o),i(o,null),y-=1,d("#"+n.proxyId).remove();break}for(var e=g.length-1;e>=0;e--)if(g[e]==this){g.splice(e,1);break}}function n(i){var e=t(i),o=d("#"+e.proxyId);o.length||(o=d('<div id="'+e.proxyId+'"></div>'),o.insertBefore(i)),o.show(),i.css({position:"fixed",top:e.offsetTop,width:h(i),left:e.offsetLeft,right:"auto"}).addClass(x).data("isPinched",!1)}function s(i,e){var o=t(i);i.css({top:o.offsetTop+e}).data("isPinched",!0)}function f(i){var e=t(i);d("#"+e.proxyId).hide(),i.css(e.initial).removeClass(x)}function r(i,e){var o,f=t(i),r=f.keepWithin;r&&(o=r.offset().top+r.height()-e-(f.height+f.offsetTop),0>o?s(i,o):i.data("isPinched")&&o>=0&&n(i))}function a(t){var i,e,o,s,a,h,c=d(window).scrollTop(),p=t&&void 0!==u?c>u?"down":"up":null;if(t&&(u=c),!y)return!1;for(a in k)if(k.hasOwnProperty(a)){if(a=Number(a),i=k[a],o=i.tacked,s=i.free,"up"!=p&&c>a&&!i.fixing){for(i.fixing=!0,h=s.length-1;h>=0;h--)e=s.pop(),n(e),o.push(e);i.fixing=!1}else if("down"!=p&&a>=c&&!i.fixing){for(i.fixing=!0,h=o.length-1;h>=0;h--)e=o.pop(),f(e),s.push(e);i.fixing=!1}for(h=o.length-1;h>=0;h--)r(o[h],c)}}function h(i){var e=t(i),o=e.initial.width!="auto"?e.initial.width:i.parent().width()-(i.outerWidth()-i.width());i.width(o)}function c(){y&&(d(window).scroll(a),d(window).on("resize",b),d("body").on("orientationchange",b).on("touchend",a))}function p(t,i){var e,o,n,s,f,r={offsetTop:0,freezeWidth:!1},a=(d(t).data("blutack-options")||"").split(";"),h={};for(f=a.length-1;f>=0;f--)e=a[f].split(":"),e.length==2&&(o=d.trim(e[0]),r[o]!==void 0&&(n=d.trim(e[1]),s=n.match(/d+/),s&&s.length==n.length?n=Number(n):"false"===n?n=!1:"true"===n&&(n=!0),h[o]=n));return d.extend({},r,h,i)}var u,l=this,d=l.jQuery,g=[],k={},v=0,w="blutack-proxy-",x="blutacked",y=0,m=!1;if(d.fn.blutack)return!1;var b=function(){var i;return function(){clearTimeout(i),i=setTimeout(function(){var i,n,s=[];for(n=g.length-1;n>=0;n--)i=g[n],s.push({elem:i,options:t(d(i)).options}),o.apply(i);for(n=s.length-1;n>=0;n--)e.apply(s[n].elem,[s[n].options])},200)}}();d.fn.blutack=function(t){return"remove"==t?this.each(function(){o.apply(this)}):"tacked"==t?this.hasClass(x):this.each(function(){e.apply(this,[p(this,t)])})},d(document).ready(function(){d(".blutack").blutack()})}).call(this);